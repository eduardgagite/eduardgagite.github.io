---
title: "Реализация счетчиков и метрик"
category: "redis"
categoryTitle: "Redis"
section: "patterns"
sectionTitle: "Паттерны и практические кейсы"
sectionOrder: 3
order: 6
---


Счётчики и метрики в Redis используют, чтобы быстро понимать, что происходит в системе: сколько раз нажали кнопку, сколько было логинов, просмотров страниц, ошибок и так далее. Всё держится на простых операциях инкремента.

## Простые счётчики

Базовый вариант — общий счётчик события. Например, сколько всего раз пользователи вошли в систему.

Увеличить счётчик:

```
INCR metrics:logins
```

Прочитать текущее значение:

```
GET metrics:logins
```

Команда **INCR** создаст ключ, если его ещё нет, и начнёт отсчёт с 1.

Аналогично можно считать клики по кнопке или отправки формы:

```
INCR metrics:click:buy
INCR metrics:form:feedback:submit
```

## Счётчики по дням

Чтобы не просто знать общий итог, а видеть статистику по времени, в ключ добавляют дату.

Например, логины по дням:

```
INCR metrics:logins:2025-11-21
```

Просмотры страницы:

```
INCR metrics:views:article:42:2025-11-21
```

Так легко построить график: приложение или аналитика просто считывают значения по датам.

Иногда у таких ключей задают время жизни, чтобы старая статистика не висела вечно:

```
EXPIRE metrics:views:article:42:2025-11-21 2592000
```

Здесь данные удалятся через 30 дней.

## Несколько метрик в одном ключе

Если метрик много, удобно собирать их в один хеш.

Пример общего хеша по системе:

```
HINCRBY metrics:global logins 1
HINCRBY metrics:global registrations 1
HINCRBY metrics:global errors 1
```

Прочитать все значения сразу:

```
HGETALL metrics:global
```

Так можно быстро получить набор ключевых показателей без обхода десятков отдельных ключей.

## Уникальные значения и HyperLogLog

Обычный счётчик показывает количество событий, но не количество уникальных пользователей. Для приблизительного подсчёта уникальных значений в Redis есть **HyperLogLog**.

Добавить пользователя в структуру:

```
PFADD metrics:uv:2025-11-21 user_42
```

Получить оценку числа уникальных пользователей за день:

```
PFCOUNT metrics:uv:2025-11-21
```

Это даёт быстрый и компактный способ считать уникальных посетителей, клиенты, сессии и другие объекты, которых может быть очень много.

## Сброс и чтение показателей

Если нужно обнулить счётчик, его просто удаляют:

```
DEL metrics:logins
```

Или сбрасывают только отдельное поле в хеше, записав нужное значение через **HSET**.

Для сбора метрик приложение обычно:

- увеличивает счётчики там, где происходят события;
- периодически читает значения и отправляет их в систему мониторинга или отчётов.

## Итого

Счётчики и метрики в Redis строятся вокруг нескольких команд: **INCR**, **HINCRBY**, **PFADD**, **PFCOUNT**. С их помощью можно считать события, разрезать статистику по дням, хранить несколько показателей в одном ключе и оценивать количество уникальных пользователей без тяжёлых запросов к основной базе.