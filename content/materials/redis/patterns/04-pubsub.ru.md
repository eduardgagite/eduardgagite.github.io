---
title: "Pub/Sub"
category: "redis"
categoryTitle: "Redis"
section: "patterns"
sectionTitle: "Паттерны и практические кейсы"
sectionOrder: 3
order: 4
---

Pub/Sub в Redis — это способ отправлять сообщения сразу многим получателям. Один отправитель публикует событие в канал, а все подписчики этого канала получают его почти мгновенно.

Этот механизм удобен для чатов, уведомлений, сигналов между сервисами и любых ситуаций, где важно «рассказать всем, кто слушает, что что‑то произошло».

## Основная идея

Есть три участника:

**Канал.** Имя, по которому объединяются отправители и получатели. Например, news:sport.

**Подписчик.** Клиент, который говорит Redis: «хочу получать всё из этого канала».

**Публикатор.** Клиент или сервис, который отправляет сообщения в каналы.

Важно: Pub/Sub не хранит историю. Сообщение видят только те, кто был подписан в момент отправки.

## Простой пример

Один клиент подписывается на канал:

```
SUBSCRIBE news:sport
```

Теперь всё, что придёт в канал news:sport, сразу попадёт этому клиенту.

Другой клиент публикует сообщение:

```
PUBLISH news:sport "Гол на 90-й минуте"
```

Подписчик увидит это сообщение мгновенно. Если в этот канал подписано несколько клиентов, все они получат один и тот же текст.

Чтобы перестать слушать канал, можно отписаться:

```
UNSUBSCRIBE news:sport
```

## Шаблоны каналов

Если нужно слушать сразу много каналов, удобно использовать шаблоны.

Подписка по шаблону:

```
PSUBSCRIBE news:*
```

Так клиент получит сообщения из всех каналов, которые начинаются с news:. Например, news:sport, news:it, news:world.

Отписка от шаблонов:

```
PUNSUBSCRIBE news:*
```

## Пример: уведомления для пользователей

Пусть у каждого пользователя есть свой канал уведомлений.

Схема ключей для каналов:

```
notifications:user:42
notifications:user:100
```

Клиент пользователя 42 подписывается на свой канал:

```
SUBSCRIBE notifications:user:42
```

Когда в системе что‑то происходит (новое сообщение, лайк, комментарий), сервер отправляет событие в нужный канал:

```
PUBLISH notifications:user:42 "Новое сообщение в чате"
```

Клиент сразу получает уведомление и может показать его в интерфейсе.

## Когда Pub/Sub подходит, а когда нет

Pub/Sub хорошо работает, когда:

**Нужна онлайн‑доставка.** Важны только те, кто сейчас подключён.

**Сообщения одноразовые.** Не нужно хранить историю.

**Много слушателей.** Одно сообщение сразу получает несколько клиентов.

Pub/Sub плохо подходит, когда:

**Сообщения нельзя терять.** Если получатель отключился, событие ему не придёт.

**Нужна история событий.** Нельзя «догнать» старые сообщения после переподключения.

В таких случаях лучше смотреть в сторону Streams или очередей задач.

## Итого

Pub/Sub в Redis — простой способ делать вещание событий: отправитель публикует сообщение в канал, все подписчики получают его сразу. Никакой истории, только живой поток. Для чатов, сигналов между сервисами и онлайн‑уведомлений этого часто достаточно, особенно на ранних этапах проекта.
