---
title: "Типичные проблемы производительности и диагностика"
category: "redis"
categoryTitle: "Redis"
section: "monitoring"
sectionTitle: "Мониторинг и отладка"
sectionOrder: 10
order: 5
---

Когда Redis «медленный», реальная причина почти всегда одна из нескольких: крупные блокирующие команды, неподходящие структуры данных, проблемы с диском (snapshot, AOF), перегруженный сетью или CPU сервер. Хорошая новость — эти ситуации повторяются из проекта в проект, и для них есть устойчивые приёмы диагностики.

Разберём несколько типичных симптомов и шаги, которые помогают быстро сузить поиск.

## Высокая задержка ответов

Симптом: время ответа Redis скачет, иногда подскакивает до десятков и сотен миллисекунд.

Что проверить:

1. Общую картину:

```
INFO stats
INFO clients
LATENCY DOCTOR
```

2. SLOWLOG:

```
SLOWLOG GET 20
```

Если в SLOWLOG видно команды вроде:

- большие LRANGE на сотни тысяч элементов;
- KEYS с широкими шаблонами;
- тяжёлые Lua‑скрипты;

то это первые кандидаты на оптимизацию.

## Просадки из‑за snapshot и AOF

Симптом: периодические пики задержек и нагрузки на диск, совпадающие с BGSAVE или BGREWRITEAOF.

Что смотреть:

```
INFO persistence
```

Полезные поля:

- rdb_last_bgsave_status и rdb_last_bgsave_time_sec;
- aof_last_bgrewrite_status и aof_last_bgrewrite_time_sec.

Если длительность фоновых операций велика, а в логах часто видны запуск BGSAVE/BGREWRITEAOF, стоит:

- уменьшить частоту snapshot;
- убедиться, что диск достаточно быстрый;
- по возможности выносить Redis и тяжёлые дисковые операции на разные устройства.

## Перегруженный одним узлом кластер

В кластере возможна ситуация, когда одна нода обрабатывает непропорционально много запросов.

Проверить:

```
CLUSTER NODES
INFO stats
```

Если один мастер показывает значительно больший instantaneous_ops_per_sec и used_memory, чем остальные, возможно:

- распределение слотов неравномерно;
- hash tags ведут слишком много ключей на одну ноду.

Решения:

- перераспределить слоты через redis-cli --cluster reshard;
- пересмотреть схему ключей и использование hash tags.

## Застрявшие или блокирующие клиенты

Симптом: растёт число blocked_clients, часть команд «висят».

Проверить:

```
INFO clients
CLIENT LIST
```

blocked_clients > 0 говорит, что есть операции, ожидающие данных (BLPOP, BRPOP, XREAD с BLOCK), или другие блокировки.

Нужно:

- убедиться, что продюсеры действительно пишут в очереди;
- проверить, нет ли ситуаций, когда потребители забывают подтверждать сообщения в Streams и переполняют PEL;
- при необходимости ограничить время блокировки и предусмотреть таймауты на стороне приложения.

## Итог

Типичные проблемы производительности в **Redis** почти всегда сводятся к тяжёлым командам, неудачной конфигурации персистентности или неравномерному распределению нагрузки.

Если использовать INFO, SLOWLOG, LATENCY DOCTOR, CLIENT LIST и, при необходимости, команды кластера, диагностика превращается в понятный набор шагов, а не в хаотичный поиск вслепую.


