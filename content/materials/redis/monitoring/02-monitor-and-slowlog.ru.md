---
title: "MONITOR, SLOWLOG и медленные команды"
category: "redis"
categoryTitle: "Redis"
section: "monitoring"
sectionTitle: "Мониторинг и отладка"
sectionOrder: 10
order: 2
---

Когда Redis начинает «тормозить», важно понять, какие именно команды его грузят: кто шлёт слишком тяжёлые запросы, какие операции работают медленно и почему. Для этого в Redis есть две мощные вещи: **MONITOR** для живого просмотра команд и **SLOWLOG** для истории медленных операций.

Эти инструменты удобно использовать в паре: MONITOR — для оперативной отладки, SLOWLOG — для системного анализа.

## MONITOR — живой поток команд

Команда **MONITOR** показывает все команды, которые выполняются на сервере, в режиме реального времени.

Пример:

```
MONITOR
```

После этого клиент начнёт получать строки вида:

```
1669212345.123456 [0 10.0.0.5:53421] "SET" "user:42" "Alice"
1669212345.234567 [0 10.0.0.6:53422] "GET" "cache:article:42"
```

Что это даёт:

- видно, какие ключи активно используются;
- можно отследить, какие сервисы шлют неожиданные команды;
- удобно в отладке на тестовой среде.

Важно:

- MONITOR сильно нагружает сервер и сеть, особенно под высокой нагрузкой;
- его не стоит использовать постоянно в продакшене;
- лучше подключаться к MONITOR с отдельного, временного клиента и на ограниченное время.

## SLOWLOG — журнал медленных команд

**SLOWLOG** хранит записи о командах, которые выполнялись дольше заданного порога.

Посмотреть текущие настройки:

```
CONFIG GET slowlog-log-slower-than
CONFIG GET slowlog-max-len
```

Типичные значения:

- slowlog-log-slower-than — порог в микросекундах (например, 10000 = 10 мс);
- slowlog-max-len — сколько записей хранить в журнале.

Пример настройки:

```
CONFIG SET slowlog-log-slower-than 10000
CONFIG SET slowlog-max-len 128
```

Просмотр журнала:

```
SLOWLOG GET 10
```

Ответ содержит:

- идентификатор записи;
- время выполнения;
- саму команду и её аргументы.

Так можно увидеть, какие конкретные запросы стабильно занимают десятки или сотни миллисекунд.

## Как использовать эти инструменты на практике

Типовой сценарий:

1. В продакшене всегда включён разумный SLOWLOG (порог в районе 5–10 мс).
2. При первых жалобах на тормоза смотрим SLOWLOG и ищем паттерны:

```
SLOWLOG GET 20
```

3. Если нужно понять, откуда точно приходят проблемные команды, временно включаем MONITOR на тесте или на отдельной реплике.
4. По результатам:

- оптимизируем ключи и команды;
- пересматриваем использование тяжёлых операций (например, KEYS, большие LRANGE, массовые скрипты).

## Итог

**MONITOR** даёт живую картинку всех команд, а **SLOWLOG** — аккуратный список самых медленных операций за последнее время.

Если держать SLOWLOG настроенным постоянно и подключать MONITOR точечно для сложных случаев, отладка производительности Redis превращается из угадывания в понятный и воспроизводимый процесс.


