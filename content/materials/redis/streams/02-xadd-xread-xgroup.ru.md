---
title: "XADD, XREAD, XGROUP"
category: "redis"
categoryTitle: "Redis"
section: "streams"
sectionTitle: "Redis Streams"
sectionOrder: 4
order: 2
---

Для работы со стримами в Redis используется набор команд, начинающихся с буквы `X`. Разберем базовые операции: добавление записей, чтение и создание групп.

## Добавление записей: XADD

Команда **XADD** добавляет новую запись в стрим. Если стрима с таким именем нет, он будет создан автоматически.

Синтаксис: `XADD ключ ID поле значение [поле значение ...]`

Чаще всего вместо ручного задания ID используют символ `*`. Это говорит Redis: "сгенерируй ID автоматически на основе текущего времени".

Добавим событие о регистрации пользователя в стрим **events:users**:

```
XADD events:users * type registration user_id 101 email "test@example.com"
```

В ответ Redis вернет сгенерированный ID, например **1700000000000-0**.

Можно ограничить размер стрима, чтобы он не съел всю память. Опция `MAXLEN` оставит только N последних записей. Тильда `~` позволяет Redis удалять старые записи приблизительно, что эффективнее для производительности.

```
XADD events:users MAXLEN ~ 1000 * type login user_id 101
```

## Чтение записей: XREAD

Команда **XREAD** читает записи из одного или нескольких стримов. Она может читать исторические данные или блокироваться в ожидании новых.

Чтобы прочитать записи, начиная с определенного момента, нужно указать ID. Redis вернет все записи, у которых ID *больше* указанного. Чтобы прочитать с самого начала, используйте `0`.

```
XREAD STREAMS events:users 0
```

### Блокирующее чтение (Real-time)

Самый частый сценарий — ожидание новых данных. Для этого используем опцию `BLOCK` (время в миллисекундах, 0 — бесконечно) и специальный ID `$`. Символ `$` означает "читай только то, что придет после момента вызова команды".

```
XREAD BLOCK 0 STREAMS events:users $
```

Если выполнить эту команду, соединение "зависнет", пока в **events:users** не появится новая запись. Как только кто-то сделает **XADD**, мы сразу получим эти данные.

## Подготовка групп: XGROUP

Простое чтение через **XREAD** имеет недостаток: если у вас пять обработчиков (воркеров), и все они сделают **XREAD ... $**, то *каждый* из них получит *одну и ту же* копию сообщения.

Для распределения задач (чтобы каждое сообщение обработал только один воркер) нужны **Consumer Groups**. Перед использованием группу нужно создать командой **XGROUP CREATE**.

Создадим группу **workers** для стрима **events:users**, начиная чтение с конца (`$`) — то есть обрабатывать будем только новые сообщения.

```
XGROUP CREATE events:users workers $
```

Если нужно обрабатывать все сообщения с самого начала стрима, используйте `0` вместо `$`.

```
XGROUP CREATE events:users analytics_group 0
```

Эта команда не читает данные, она лишь регистрирует группу в Redis. Само чтение происходит через **XREADGROUP**, о чем мы поговорим в следующей части.

## Итого

**XADD** добавляет записи в журнал, **XREAD** позволяет читать их как массив или в режиме реального времени, а **XGROUP** подготавливает инфраструктуру для распределенной обработки. Используйте `*` для автогенерации ID и `$` для подписки на новые события.
