---
title: "XADD, XREAD, XGROUP"
category: "redis"
categoryTitle: "Redis"
section: "streams"
sectionTitle: "Redis Streams"
sectionOrder: 4
order: 2
---

## Зачем нужны XADD, XREAD и XGROUP

Redis Streams строятся вокруг трёх ключевых команд: **XADD** для записи событий, **XREAD** для чтения и **XGROUP** для организации группы потребителей. Вместе они позволяют превратить Redis в простую, но очень быструю систему очередей задач и событий.

Разберёмся, как по шагам записывать события, читать их и готовить поток к работе с несколькими воркерами.

## Запись событий с помощью XADD

Команда **XADD** добавляет новое сообщение в поток. Мы указываем ключ потока, идентификатор сообщения (или звёздочку) и набор полей с данными.

Например, сервис заказов отправляет события в поток **order:events**:

```
XADD order:events * user_id 123 status created
XADD order:events * user_id 123 status paid
XADD order:events * user_id 456 status created
```

Каждое сообщение — это маленький объект с полями. Здесь мы сохраняем идентификатор пользователя и статус заказа.

Часто при записи сразу ограничивают длину потока, чтобы не накапливать бесконечную историю:

```
XADD order:events MAXLEN ~ 10000 * user_id 123 status created
```

Так мы гарантируем, что в памяти останутся только последние несколько тысяч событий.

## Чтение событий с помощью XREAD

Команда **XREAD** позволяет читать сообщения из одного или нескольких потоков. Ей нужно указать:

- какие потоки читать;
- с какого идентификатора начать.

Например, прочитать все события с начала:

```
XREAD STREAMS order:events 0-0
```

Часто нужно читать только новые сообщения, блокируясь в ожидании. Для этого используют специальный идентификатор больше и параметр BLOCK:

```
XREAD BLOCK 0 STREAMS order:events >
```

Такой вызов удобно использовать в воркере: он «засыпает» до появления новых задач и просыпается только когда есть что обрабатывать.

## Группы потребителей с XGROUP

Когда один поток читают несколько воркеров, важно распределить сообщения между ними и не потерять их при сбоях. Для этого у Streams есть группы потребителей, которые создаются командой **XGROUP**.

Создадим группу **order-workers** для потока **order:events**:

```
XGROUP CREATE order:events order-workers 0-0 MKSTREAM
```

Если потока ещё нет, флаг MKSTREAM создаст его автоматически. Число 0-0 говорит, что группа будет видеть все старые сообщения с начала потока.

После создания группы воркеры читают события не через XREAD, а через XREADGROUP:

```
XREADGROUP GROUP order-workers worker-1 COUNT 10 STREAMS order:events >
```

В этом примере:

- **order-workers** — имя группы;
- **worker-1** — имя конкретного потребителя в группе;
- COUNT 10 — максимум сообщений за один вызов;
- символ больше означает «новые сообщения для этой группы».

Redis распределит сообщения между потребителями внутри группы и будет помнить, какие из них уже были прочитаны и подтверждены.

## Итого

Команда **XADD** записывает события в поток, **XREAD** позволяет читать их по порядку, а **XGROUP** подготавливает поток к работе с несколькими воркерами. На этих трёх командах строится большая часть практики работы с Redis Streams.

Ключевая идея в том, что **Streams + XADD/XREAD/XGROUP превращают Redis в надёжный журнал событий и основу для очередей задач**, не требуя сложной инфраструктуры.


