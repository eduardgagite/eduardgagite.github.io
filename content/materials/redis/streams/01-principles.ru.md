---
title: "Принципы работы"
category: "redis"
categoryTitle: "Redis"
section: "streams"
sectionTitle: "Redis Streams"
sectionOrder: 4
order: 1
---

## Что такое Redis Streams

Streams в Redis — это лог событий, куда мы последовательно записываем сообщения и при необходимости читаем историю. Это удобный способ описывать «что происходило» в системе: какие заказы создались, какие письма отправились, какие операции прошли через сервис.

В отличие от обычных структур данных, потоки хорошо подходят для асинхронной обработки: один сервис пишет события, другой читает и реагирует на них, не блокируя основную логику.

## Основные свойства потоков

Streams устроены как упорядоченный журнал записей. У каждого сообщения есть уникальный идентификатор, а Redis гарантирует порядок внутри одного потока.

### Идентификаторы сообщений

Каждое сообщение в потоке получает идентификатор вида таймштамп-последовательность, например 1713788220000-0. Его можно задать вручную или поручить Redis, используя символ звёздочки.

Например, сервис заказов пишет события в поток **order:events**:

```
XADD order:events * user_id 123 status created
XADD order:events * user_id 456 status paid
```

Redis сам присвоит сообщениям упорядоченные идентификаторы, а мы всегда сможем узнать, какое событие произошло раньше.

### Хранение истории и чтение

Главное отличие потоков от классического Pub/Sub — возможность читать историю. Новый потребитель может подключиться и последовательно прочитать все прошлые события, а не только те, что придут после подписки.

Прочитать все события с начала потока можно так:

```
XREAD COUNT 10 STREAMS order:events 0-0
```

Если вместо 0-0 указать символ больше, Redis вернёт только новые сообщения, появившиеся после этой точки:

```
XREAD BLOCK 0 STREAMS order:events >
```

Так можно строить долгоживущие воркеры, которые «слушают» поток и обрабатывают приходящие задачи.

### Управление размером потока

Если без ограничений писать события в поток, он будет расти бесконечно и рано или поздно займёт слишком много памяти. Поэтому у потоков почти всегда настраивают ограничение длины.

Например, хранить только последние 1000 событий:

```
XADD order:events MAXLEN ~ 1000 * user_id 123 status created
```

Тильда помогает Redis выполнять обрезку более эффективно, не цепляясь за точное значение.

## Streams и другие структуры данных

Streams удобно использовать, когда важны порядок и история событий: журналы действий пользователей, бизнес-события, очереди задач. Для простых списков значений или кэша лучше подойдут строки, хэши и наборы.

Если нужно мгновенное широковещательное сообщение без истории, удобнее классический Pub/Sub. Если важна именно надёжная очередь с возможностью повторного чтения и подтверждений, лучше подойдут Streams.

## Итого

Streams в Redis — это упорядоченный журнал событий с возможностью читать и переигрывать историю. Они позволяют строить асинхронные процессы: один сервис пишет события, другие в своём темпе читают и обрабатывают их.

Главное, что стоит запомнить: **Streams — это основа для событийных систем и очередей задач в Redis, где важны порядок и история сообщений**.


