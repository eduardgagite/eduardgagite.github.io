---
title: "Принципы работы"
category: "redis"
categoryTitle: "Redis"
section: "streams"
sectionTitle: "Redis Streams"
sectionOrder: 4
order: 1
---

**Redis Streams** — это структура данных, похожая на лог (журнал) событий, в который можно только дописывать новые записи. Если вы знакомы с Apache Kafka, то Redis Streams реализует похожую концепцию, но внутри Redis. Это не просто список (**List**) или канал (**Pub/Sub**), а более мощный инструмент для хранения и распределения потоков данных.

Стримы идеально подходят для создания очередей сообщений, логов активности пользователей, систем уведомлений и архитектур, управляемых событиями (Event Sourcing).

## Основные отличия от других структур

Часто возникает вопрос: зачем нужен Stream, если есть List или Pub/Sub?

**List (Списки)** хороши для простых очередей, но они не умеют удобно распределять задачи между множеством потребителей с гарантией доставки. Если рабочий процесс упал во время обработки элемента из списка (после LPOP), сообщение потеряно навсегда.

**Pub/Sub (Каналы)** позволяют многим подписчикам получать сообщения, но они работают по принципу "выстрелил и забыл". Сообщения не сохраняются: если подписчик был офлайн, он ничего не получит.

**Streams (Потоки)** решают эти проблемы:
- Данные сохраняются и хранятся в памяти (можно настроить ограничение по длине).
- У каждой записи есть уникальный ID.
- Поддерживаются **Consumer Groups** (группы потребителей) для распределения нагрузки.
- Есть механизм подтверждения обработки (**ACK**), что гарантирует надежность.

## Структура записи

Каждая запись в стриме состоит из уникального идентификатора и набора полей "ключ-значение". Это напоминает хеш (**Hash**), привязанный к временной метке.

Идентификатор записи (ID) обычно генерируется автоматически и выглядит как **1526919030474-0**.
- Первая часть — это время создания в миллисекундах.
- Вторая часть — порядковый номер внутри одной миллисекунды (для разрешения коллизий).

Такая структура позволяет легко делать выборки по времени: "дай мне все события за последний час".

## Как это выглядит

Представьте поток заказов в интернет-магазине. Каждое событие — это запись в стриме **orders:stream**.

```
ID: 1618590010000-0
user_id: 42
item: "laptop"
price: 1200

ID: 1618590015000-0
user_id: 108
item: "mouse"
price: 25
```

Эти записи хранятся в хронологическом порядке. Новые всегда добавляются в конец. Вы можете читать их с начала, с конца, с определенного момента времени или ждать появления новых записей в режиме реального времени.

## Итого

**Redis Streams** — это надежный, упорядоченный по времени журнал сообщений. Он объединяет преимущества списков и Pub/Sub: данные не теряются, их можно читать в реальном времени или из истории, и удобно распределять между несколькими обработчиками. Это стандарт де-факто для очередей задач в современном Redis.
