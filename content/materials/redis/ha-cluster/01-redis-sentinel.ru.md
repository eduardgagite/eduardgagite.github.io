---
title: "Redis Sentinel"
category: "redis"
categoryTitle: "Redis"
section: "ha-cluster"
sectionTitle: "Высокая доступность и кластеризация"
sectionOrder: 8
order: 1
---

**Redis Sentinel** — это отдельный компонент, который следит за master и репликами, замечает сбои и при необходимости сам переключает роль на одну из реплик. Можно считать его «наблюдателем» и «аварийным переключателем» для Redis.

Главная цель Sentinel — убрать ручной failover и сделать так, чтобы приложение всегда знало, куда писать, даже если один из узлов упал.

## Что делает Sentinel

Sentinel выполняет сразу несколько задач:

- мониторит состояние master и replica;
- решает, когда master считается недоступным;
- выбирает подходящую реплику и продвигает её в новый master;
- сообщает клиентам, где сейчас активный master.

Список наблюдаемых узлов и параметры порогов задаются в конфиге Sentinel.

## Минимальная конфигурация Sentinel

Sentinel — это отдельный процесс Redis, запущенный в специальном режиме.

Пример простого конфига для одного мастера:

```
port 26379

sentinel monitor mymaster 10.0.0.1 6379 2
sentinel down-after-milliseconds mymaster 5000
sentinel parallel-syncs mymaster 1
sentinel failover-timeout mymaster 60000
```

Здесь:

- **mymaster** — имя наблюдаемого кластера Redis;
- **10.0.0.1 6379** — адрес master;
- **2** — сколько Sentinel должно согласиться, чтобы признать master мёртвым;
- **down-after-milliseconds** — через сколько миллисекунд без ответа считать master недоступным;
- **parallel-syncs** — сколько реплик можно одновременно пересинхронизировать после failover;
- **failover-timeout** — окно времени, в котором должен уложиться процесс переключения.

Обычно запускают минимум три экземпляра Sentinel, чтобы решения принимались большинством.

## Как клиенты узнают о новом master

Sentinel сам меняет роли узлов, но приложение должно знать, куда теперь отправлять записи.

Есть два основных подхода:

- клиенты, умеющие работать с Sentinel (драйверы для Redis), сами запрашивают у него адрес актуального master;
- дополнительный слой (прокси, сервис‑дискавери) использует информацию Sentinel, чтобы отдавать клиентам правильный адрес.

Пример запроса из клиента к Sentinel для получения адреса master:

```
SENTINEL get-master-addr-by-name mymaster
```

Ответом будет текущий host и port активного master.

## Итог

**Redis Sentinel** добавляет к репликации слой наблюдения и автоматического переключения: он следит за узлами, решает, что master недоступен, и продвигает реплику в новую роль.

При правильно настроенных порогах и нескольких экземплярах Sentinel можно избавиться от ручного failover и сделать Redis заметно более устойчивым к сбоям отдельных серверов.


