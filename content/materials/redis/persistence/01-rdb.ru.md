---
title: "RDB: снимки данных на диск"
category: "redis"
categoryTitle: "Redis"
section: "persistence"
sectionTitle: "Персистентность данных"
sectionOrder: 6
order: 1
---

Режим **RDB** — это периодические снимки состояния Redis на диск. Сервер в какой‑то момент «замораживает» данные и записывает их в бинарный файл **RDB**, чтобы при перезапуске быстро восстановиться до этого состояния.

Такой подход минимально влияет на производительность в обычное время и хорошо подходит для резервного копирования, но при аварии между снимками часть последних изменений может потеряться.

## Как работает RDB на практике

Redis сохраняет снимок либо по расписанию, либо по явной команде. Внутри используется механизм **BGSAVE**: сервер делает fork процесса, и дочерний процесс пишет данные в RDB‑файл, пока основной продолжает принимать команды.

Посмотреть текущие настройки сохранения:

```
CONFIG GET save
CONFIG GET dbfilename
CONFIG GET dir
```

Пример типичной конфигурации:

```
save 900 1
save 300 10
save 60 10000
dbfilename dump.rdb
dir /var/lib/redis
```

Это значит, что Redis создаст snapshot, если за 900 секунд произошёл хотя бы 1 апдейт, или за 300 секунд — 10 апдейтов, или за 60 секунд — 10000 апдейтов.

## Ручное создание snapshot

Иногда нужно сделать снимок «по требованию», например перед обновлением приложения.

Синхронное сохранение (блокирует сервер):

```
SAVE
```

Асинхронное сохранение (рекомендуется для продакшена):

```
BGSAVE
```

После **BGSAVE** в каталоге **dir** появится обновлённый **dump.rdb**. Этот файл можно:

- скопировать на удалённый сервер как резервную копию;
- использовать для поднятия тестового окружения;
- хранить в бэкап‑хранилище вместе с другими бэкапами.

## Что происходит при перезапуске

Когда Redis стартует и находит в каталоге **dump.rdb**, он:

1. Загружает данные из RDB в память.
2. Начинает принимать команды, как обычно.

Все изменения, сделанные после последнего snapshot, будут потеряны. Если, например, RDB создавался раз в 5 минут, а сервер упал через 4 минуты после сохранения, эти 4 минуты операций не восстановятся.

Поэтому RDB воспринимают как вариант «периодической» персистентности, где допускается небольшой временной лаг в данных.

## Когда RDB уместен, а когда нет

RDB хорошо подходит для:

- резервного копирования состояния Redis;
- сценариев, где допустима потеря части последних данных;
- относительно спокойных по записи систем, где snapshot не слишком нагружает диск и память.

RDB хуже подходит, когда:

- важна почти нулевая потеря данных при сбое;
- нагрузка на запись высокая, и частые snapshot создают заметную нагрузку;
- Redis используется как основной источник финансовых или других критичных данных.

В таких случаях RDB часто комбинируют с **AOF** или включают отдельные механизмы репликации и бэкапов.

## Итог

RDB — это простой и быстрый способ периодически сохранять состояние Redis на диск в одном бинарном файле.

Этот режим почти не мешает производительности в обычной работе и удобен для бэкапов, но всегда нужно помнить, что между снимками часть недавних операций может быть потеряна при аварийном перезапуске.


