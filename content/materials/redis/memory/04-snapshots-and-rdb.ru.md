title: "Работа со snapshot и RDB-файлами"
category: "redis"
categoryTitle: "Redis"
section: "memory"
sectionTitle: "Управление памятью"
sectionOrder: 5
order: 4
---

Помимо оперативной памяти, **Redis** умеет сохранять снимки данных на диск в виде **RDB-файлов**. С точки зрения управления памятью важно не то, как именно устроены snapshot, а как они влияют на расход RAM и нагрузку под высокой записью.

За общую механику RDB и персистентность в целом отвечает отдельный раздел про персистентность данных. Здесь сосредоточимся именно на памяти и типичных проблемах при включённых snapshot.

## Автоматические snapshot и их влияние

В конфиге Redis часто можно увидеть строки вида:

```
save 900 1
save 300 10
save 60 10000
```

Это означает:

- если за 900 секунд был хотя бы 1 запрос на изменение данных — сделать snapshot;
- если за 300 секунд было 10 изменений — тоже сохранить;
- если за 60 секунд было 10000 изменений — снова сохранить.

При каждом таком срабатывании Redis будет запускать **BGSAVE**, то есть делать копию данных в памяти и писать её на диск. Для небольших инстансов это дёшево, но при десятках гигабайт данных:

- возрастает потребление памяти из‑за copy-on-write;
- возможны короткие пики нагрузки на диск;
- время BGSAVE может стать заметным.

Если Redis используется как чистый кэш и потеря данных допустима, автоматические snapshot часто отключают:

```
CONFIG SET save ""
```

В этом режиме RDB-файлы не создаются, а объём памяти и нагрузка на диск предсказуемее.

## Snapshot и память: что важно учитывать

При запуске **BGSAVE** Redis делает fork процесса. Операционная система использует механизм copy-on-write: страницы памяти копируются только при изменении. Но если в момент snapshot идёт активная запись, реальное потребление памяти может заметно вырасти.

Практические рекомендации:

- не запускать **SAVE** на больших базах в продакшене;
- планировать **BGSAVE** на спокойные периоды с меньшим количеством записей;
- учитывать запас памяти на сервере, если объём данных в Redis уже близок к лимиту.

Если лимит памяти и политики вытеснения настроены агрессивно, а snapshot включён часто, можно неожиданно уткнуться в недостаток RAM во время BGSAVE.

## Итог

Snapshot в **Redis** — это не только про персистентность, но и про память: при запуске BGSAVE возрастает потребление RAM и нагрузка на диск, что может стать проблемой на загруженных или уже «заполненных» инстансах.

Если воспринимать snapshot как ещё один фактор, влияющий на расход памяти, и планировать их с учётом лимитов **maxmemory** и профиля нагрузки, можно спокойно использовать RDB, не получая неожиданных отказов по памяти.


