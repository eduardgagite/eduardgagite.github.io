---
title: "Геопространственные данные"
category: "redis"
categoryTitle: "Redis"
section: "data"
sectionTitle: "Структуры данных"
sectionOrder: 2
order: 5
---

**Redis** умеет работать с географическими координатами и быстро находить объекты в радиусе от заданной точки, вычислять расстояния между точками и строить простые гео‑запросы. Внутри это реализовано через упорядоченные множества, но команды **GEO*** упрощают работу с координатами.

Геопространственные данные полезны для поиска ближайших ресторанов, расчёта расстояний доставки, отображения объектов на карте и других задач, где важны координаты.

## Добавление точек на карту

Команда **GEOADD** добавляет точку с координатами в структуру. Координаты задаются как долгота и широта.

Пример добавления нескольких точек:

```
GEOADD restaurants 37.6173 55.7558 "Cafe Pushkin"
GEOADD restaurants 37.6231 55.7520 "Teremok"
GEOADD restaurants 37.6098 55.7525 "Starbucks"
```

Здесь:

- **restaurants** — имя ключа, где хранятся точки;
- первое число — долгота (longitude);
- второе число — широта (latitude);
- последний аргумент — название или идентификатор точки.

Можно добавить несколько точек за один вызов:

```
GEOADD restaurants 37.6173 55.7558 "Cafe Pushkin" 37.6231 55.7520 "Teremok"
```

## Поиск точек в радиусе

Команда **GEORADIUS** находит все точки в заданном радиусе от центральной координаты.

Пример поиска ресторанов в радиусе 1 километра:

```
GEORADIUS restaurants 37.6200 55.7550 1 km
```

Здесь:

- **37.6200 55.7550** — координаты центра;
- **1 km** — радиус поиска (можно указать в метрах: **1000 m**).

Команда вернёт список названий точек, которые попадают в радиус.

Чтобы получить не только названия, но и расстояния до них:

```
GEORADIUS restaurants 37.6200 55.7550 1 km WITHDIST
```

Опция **WITHCOORD** вернёт координаты найденных точек:

```
GEORADIUS restaurants 37.6200 55.7550 1 km WITHCOORD
```

Можно комбинировать опции:

```
GEORADIUS restaurants 37.6200 55.7550 1 km WITHDIST WITHCOORD
```

## Поиск по расстоянию от существующей точки

Если нужно найти точки в радиусе от уже известной точки, используют **GEORADIUSBYMEMBER**.

Пример: найти все рестораны в радиусе 500 метров от **Cafe Pushkin**:

```
GEORADIUSBYMEMBER restaurants "Cafe Pushkin" 500 m
```

Это удобно, когда центральная точка уже есть в структуре и не нужно указывать координаты вручную.

## Вычисление расстояния между точками

Команда **GEODIST** вычисляет расстояние между двумя точками.

Пример:

```
GEODIST restaurants "Cafe Pushkin" "Teremok" km
```

Команда вернёт расстояние в километрах. Можно указать другие единицы: **m** (метры), **mi** (мили), **ft** (футы).

Если одна из точек не найдена, команда вернёт пустое значение.

## Получение координат точки

Чтобы узнать координаты уже добавленной точки, используют **GEOPOS**.

Пример:

```
GEOPOS restaurants "Cafe Pushkin"
```

Команда вернёт массив координат: сначала долготу, потом широту.

## Хеш для хранения координат

По умолчанию **GEOADD** хранит координаты в виде геохеша (geohash), который оптимизирован для быстрого поиска. Но можно явно указать, что координаты нужно хранить как обычные значения.

Для большинства задач это не нужно, но если требуется максимальная точность или специфичные запросы, можно работать с координатами напрямую через **ZADD** и геохеши.

## Практические сценарии

**Поиск ближайших объектов.** Приложение для доставки еды находит ближайшие рестораны к адресу клиента.

```
GEORADIUS restaurants 37.6200 55.7550 2 km WITHDIST
```

**Расчёт стоимости доставки.** По расстоянию между рестораном и клиентом вычисляется цена доставки.

```
GEODIST restaurants "Cafe Pushkin" "Client Address" km
```

**Отображение на карте.** Все точки в видимой области карты выбираются через **GEORADIUS** с нужным радиусом.

**Поиск по шаблону.** Комбинируя **GEORADIUS** с фильтрацией по другим полям (например, через отдельные ключи), можно строить сложные запросы: «ближайшие рестораны с рейтингом выше 4.5».

## Ограничения и особенности

Геопространственные команды Redis хорошо работают для задач в пределах одного города или региона. Для глобальных запросов (поиск по всей планете) точность может снижаться из‑за особенностей проекции координат.

Важно помнить:

- координаты должны быть в формате WGS84 (стандартный формат GPS);
- долгота указывается первой, широта — второй (не наоборот);
- радиус поиска лучше ограничивать разумными значениями (не больше нескольких десятков километров для точных результатов).

## Итого

**Геопространственные команды Redis** позволяют быстро находить объекты по координатам, вычислять расстояния и строить простые гео‑запросы без сложных вычислений на стороне приложения.

Для задач вроде поиска ближайших точек, расчёта расстояний доставки и отображения объектов на карте **GEO*** команды дают удобный и быстрый способ работы с координатами прямо в Redis.

