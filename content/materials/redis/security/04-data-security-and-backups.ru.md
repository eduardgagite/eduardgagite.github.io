---
title: "Безопасность данных и бэкапы"
category: "redis"
categoryTitle: "Redis"
section: "security"
sectionTitle: "Безопасность"
sectionOrder: 9
order: 4
---

Помимо защиты доступа к самому Redis, важно подумать о том, что происходит с данными на диске и в бэкапах. Если RDB‑ и AOF‑файлы лежат в открытом виде, их кража может быть не менее опасна, чем прямой доступ к серверу.

Задача — сделать так, чтобы потеря диска или бэкапного хранилища не означала автоматическую утечку всех пользовательских данных.

## Где лежат файлы Redis

Сначала нужно чётко понимать, где именно находятся данные Redis.

Посмотреть настройки:

```
CONFIG GET dir
CONFIG GET dbfilename
CONFIG GET appendfilename
```

Типичный ответ:

```
dir /var/lib/redis
dbfilename dump.rdb
appendfilename appendonly.aof
```

Это означает, что:

- snapshot RDB лежит в /var/lib/redis/dump.rdb;
- журнал AOF — в /var/lib/redis/appendonly.aof.

Именно эти файлы нужно включать в зону повышенной защиты: права доступа, мониторинг, шифрование диска.

## Права доступа и изоляция на сервере

Минимальные меры:

- запускать Redis под отдельным пользователем (например, redis);
- ограничить доступ к каталогу данных:

```
chown -R redis:redis /var/lib/redis
chmod 700 /var/lib/redis
```

Так только пользователь redis будет иметь прямой доступ к файлам RDB и AOF. Остальные пользователи системы не смогут просто так их прочитать.

В контейнерных и облачных окружениях аналогичные ограничения задаются через политики безопасности и права на volume.

## Шифрование диска и бэкапов

Чтобы кража диска или snapshot в облаке не привела к мгновенной утечке, стоит использовать шифрование:

- на уровне файловой системы (LUKS, BitLocker, eCryptfs и аналоги);
- на уровне облачного диска (встроенное шифрование в облаке);
- на уровне бэкапного хранилища (S3‑совместимые хранилища с включённым encryption at rest).

Алгоритм простой:

1. Включить шифрование для дисков, где лежит каталог Redis.
2. Включить шифрование для хранилища бэкапов.
3. Следить, чтобы ключи шифрования хранились отдельно от данных и были защищены.

Так даже физическая кража диска не позволит прочитать содержимое без доступа к ключам.

## Чувствительные данные в Redis

Отдельный вопрос — какие именно данные вы кладёте в Redis.

Практика:

- по возможности избегать хранения «голых» персональных данных (ФИО, адреса, документы);
- для особо чувствительных полей использовать шифрование на уровне приложения и хранить в Redis уже зашифрованные значения;
- не кэшировать в Redis то, что нельзя безопасно восстановить или аннулировать.

Пример:

вместо хранения телефона как есть:

```
SET user:42:phone "+123456789"
```

приложение может хранить зашифрованную строку, а ключи шифрования держать отдельно, например в KMS:

```
SET user:42:phone "ENC:....."
```

Даже если кто‑то прочитает dump.rdb, расшифровать содержимое без доступа к KMS будет значительно сложнее.

## Итог

Безопасность данных в **Redis** — это не только пароли и ACL, но и защита RDB/AOF‑файлов, дисков и бэкапов, а также осознанный подход к тому, какие данные и в каком виде мы туда кладём.

Если ограничить права доступа к файлам, шифровать хранилища и не хранить в Redis лишнюю чувствительную информацию в открытом виде, последствия утечки или кражи инфраструктуры будут гораздо менее критичными.


