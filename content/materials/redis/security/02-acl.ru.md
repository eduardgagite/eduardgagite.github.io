---
title: "ACL и разграничение прав"
category: "redis"
categoryTitle: "Redis"
section: "security"
sectionTitle: "Безопасность"
sectionOrder: 9
order: 2
---

Пароль на весь Redis — это минимум. В более сложных системах хочется давать разным сервисам разные права: одним только чтение, другим ограниченный набор команд, третьим полный доступ. Для этого в **Redis** есть **ACL** — списки контроля доступа.

Идея проста: создаём пользователей с разными правами, выдаём каждому свои учётные данные и описываем, что им можно.

## Просмотр и базовые команды ACL

Посмотреть текущих пользователей:

```
ACL LIST
```

Получить информацию о конкретном пользователе:

```
ACL GETUSER default
```

Создать нового пользователя и выдать ему права:

```
ACL SETUSER app-reader on >strong-pass ~* +GET +MGET +INFO
```

Разбор:

- on — включить пользователя;
- >strong-pass — задать пароль;
- ~* — разрешить доступ ко всем ключам (ограничения по шаблонам разберём ниже);
- +GET +MGET +INFO — список разрешённых команд.

После этого клиент может аутентифицироваться как app-reader:

```
AUTH app-reader strong-pass
GET cache:article:42
```

## Ограничения по ключам

Кроме команд, можно ограничивать доступ по шаблонам ключей.

Пример: сервис, который должен видеть только свои ключи сессий.

Создадим пользователя:

```
ACL SETUSER session-service on >session-pass ~session:* +GET +SET +DEL
```

Здесь:

- ~session:* — разрешён доступ только к ключам, начинающимся с session:;
- +GET +SET +DEL — можно читать, записывать и удалять свои сессии.

Если такой пользователь попробует обратиться к cache:article:42, Redis вернёт ошибку доступа.

## Разделение ролей по сервисам

Практичный подход — завести отдельных пользователей под разные типы сервисов:

- для фоновых задач — право на чтение и запись очередей и кэша;
- для публичного API — ограниченный набор чтений и безопасных записей;
- для административных инструментов — расширенный набор команд.

Примеры:

Сервис кэша:

```
ACL SETUSER cache-service on >cache-pass ~cache:* +GET +SET +DEL +EXPIRE
```

Сервис метрик:

```
ACL SETUSER metrics-service on >metrics-pass ~metrics:* +INCR +GET +MGET
```

Админ:

```
ACL SETUSER admin on >admin-pass allcommands allkeys
```

Такой расклад позволяет, даже при утечке одного пароля, сильно ограничить ущерб.

## Итог

ACL в **Redis** позволяют задать тонкую модель доступа: какие команды доступны, к каким ключам можно обращаться и под какими учётными данными работает каждый сервис.

Если для разных частей системы завести отдельных пользователей с минимально необходимыми правами, даже компрометация одной учётной записи не даст злоумышленнику полный контроль над всей базой.


