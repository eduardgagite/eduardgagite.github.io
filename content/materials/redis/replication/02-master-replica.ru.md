---
title: "Настройка master–replica"
category: "redis"
categoryTitle: "Redis"
section: "replication"
sectionTitle: "Репликация"
sectionOrder: 7
order: 2
---

Настроить схему master–replica в Redis можно двумя способами: через конфигурационные файлы при запуске или через команды во время работы сервера. В обоих случаях идея одна и та же — указать реплике, у какого master она должна забирать данные.

Разберём минимальную конфигурацию и практические команды, которые пригодятся в разработке и продакшене.

## Базовая конфигурация через redis.conf

Представим, что у нас два сервера:

- основной: **10.0.0.1:6379**;
- реплика: **10.0.0.2:6379**.

На master конфигурация может быть минимальной:

```
bind 0.0.0.0
port 6379
```

На реплике достаточно указать, откуда брать данные:

```
bind 0.0.0.0
port 6379

replicaof 10.0.0.1 6379
```

После запуска:

- master принимает все записи;
- replica подключается к master, делает полную синхронизацию и дальше подтягивает изменения.

Проверить роли можно командой:

```
INFO replication
```

На реплике важно держать включённым режим только для чтения, чтобы случайно не писать в неё напрямую:

```
replica-read-only yes
```

## Настройка через команды во время работы

Иногда удобнее настраивать репликацию «на лету» без перезапуска.

Пусть Redis уже запущен на обоих серверах. Тогда на реплике достаточно выполнить:

```
REPLICAOF 10.0.0.1 6379
```

С этого момента узел станет replica указанного master. Если позднее нужно вернуть его к одиночному режиму:

```
REPLICAOF NO ONE
```

Эта команда отключает репликацию, и узел снова становится самостоятельным master с теми данными, которые у него есть.

Полезно проверять текущую роль:

```
ROLE
```

Ответ покажет, является ли сервер master, replica и какие есть соединения.

## Настройка доступа и безопасности

Если на master включена авторизация, реплика должна знать пароль, чтобы подключиться.

На master:

```
requirepass "strong-master-password"
```

На реплике:

```
masterauth "strong-master-password"
replicaof 10.0.0.1 6379
```

В новых версиях можно использовать ACL и более гибкие правила, но базовая идея остаётся той же: реплика аутентифицируется к master и после этого начинает получать данные.

Важно:

- не использовать один и тот же Redis для разных окружений (dev, stage, prod);
- ограничивать доступ по сети к портам Redis;
- следить, чтобы реплика не «убежала» синхронизироваться с неправильным master.

## Итог

Настройка master–replica в **Redis** сводится к простым шагам: указать реплике адрес master, проверить роли и, при необходимости, настроить авторизацию.

Дальше Redis сам берёт на себя полную и частичную синхронизацию, а задача разработчика — правильно встроить эту схему в инфраструктуру и не писать напрямую в реплики.


