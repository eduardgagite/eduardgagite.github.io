---
title: "Принципы репликации"
category: "redis"
categoryTitle: "Redis"
section: "replication"
sectionTitle: "Репликация"
sectionOrder: 7
order: 1
---

**Репликация** в Redis позволяет копировать данные с одного узла на один или несколько реплик. Основной узел принимает записи, а реплики получают поток изменений и поддерживают у себя почти такое же состояние. Это нужно для отказоустойчивости и разгрузки чтения.

Базовая идея: есть один ведущий сервер, который принимает все изменения, и несколько ведомых, которые синхронно или с небольшой задержкой подтягивают данные.

## Роль master и replica

В простейшем варианте конфигурации есть:

- один основной узел, который принимает команды записи;
- несколько реплик, которые получают данные только от master.

Посмотреть роли можно через:

```
INFO replication
```

На master вывод будет содержать примерно такое:

```
role:master
connected_slaves:1
slave0:ip=10.0.0.2,port=6379,state=online,offset=12345,lag=0
```

На реплике:

```
role:slave
master_host:10.0.0.1
master_port:6379
master_link_status:up
```

По умолчанию реплики работают только на чтение. Это защищает от случайных изменений данных на нескольких узлах и упрощает логику приложения: все записи идут в один master.

## Односторонний поток данных

Репликация в Redis всегда идёт в одну сторону: replica копирует состояние с master, но не наоборот.

При первом подключении реплика:

1. Запрашивает полную синхронизацию.
2. Получает snapshot данных от master.
3. Применяет к себе этот snapshot.
4. Дальше принимает поток новых команд и применяет их по мере прихода.

Если соединение временно обрывается, Redis пытается сделать частичную синхронизацию, используя журнал смещений, чтобы не пересылать всю базу заново. Но в простом понимании важно помнить: master считается источником правды, а replica — копией.

## Зачем нужна репликация

Репликация решает сразу несколько задач:

- распределение нагрузки по чтению — запросы могут идти на реплики;
- резервная копия данных в реальном времени;
- подготовка площадки для быстрого переключения в случае сбоя master.

Типичные сценарии:

- выделить master для записи, а отчётные запросы и тяжёлые чтения отправлять на реплики;
- держать одну replica в другом датацентре для аварийного восстановления;
- использовать набор master и нескольких replica как основу для автоматического failover через Sentinel или кластер.

## Итог

Репликация в **Redis** строится вокруг простой модели master–replica: один узел принимает изменения, остальные получают от него поток данных и поддерживают актуальное состояние.

Такой подход помогает масштабировать чтение и повышать отказоустойчивость, не усложняя приложение сложной логикой записи на несколько узлов одновременно.


