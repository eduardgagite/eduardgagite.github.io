---
title: "Запуск от непривилегированного пользователя"
category: "docker"
categoryTitle: "Docker"
section: "security"
sectionTitle: "Безопасность"
sectionOrder: 9
order: 1
---

По умолчанию процессы в контейнере работают от имени **root**.
Это значит, что если злоумышленник взломает ваше Node.js приложение (например, через уязвимость в npm-пакете) и сможет выбраться из контейнера (container breakout), он окажется на вашем сервере с правами root. Это катастрофа.

## Решение: USER в Dockerfile

Всегда создавайте и используйте обычного пользователя внутри Dockerfile.

```dockerfile
FROM node:18-alpine

WORKDIR /app

# Копируем файлы (владельцем пока будет root)
COPY . .

# Меняем владельца файлов на node (этот юзер уже есть в node-образах)
# Или создаем своего: RUN addgroup -S appgroup && adduser -S appuser -G appgroup
RUN chown -R node:node /app

# Переключаемся на пользователя node
USER node

# Теперь все дальнейшие команды (CMD, RUN) будут выполняться от user: node
CMD ["node", "index.js"]
```

## Проверка

Запустите контейнер и проверьте, кто вы:

```bash
docker exec my-app whoami
# Должно вернуть: node
# Если вернуло: root — у вас проблемы
```

## Ограничение портов

Обычный пользователь (не root) не может слушать порты ниже 1024 (например, 80 или 443).
Поэтому внутри контейнера ваше приложение должно слушать порт 3000 или 8080.
А уже снаружи через Docker вы можете пробросить его на 80-й порт: `-p 80:3000`.

## Итого

Никогда не запускайте продакшен-сервисы от root. Добавьте инструкцию `USER` в свой Dockerfile. Это одна строчка, которая закрывает огромную дыру в безопасности.

