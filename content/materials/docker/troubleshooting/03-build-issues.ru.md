---
title: "Проблемы со сборкой: build context, cache miss"
category: "docker"
categoryTitle: "Docker"
section: "troubleshooting"
sectionTitle: "Типичные проблемы и решения"
sectionOrder: 10
order: 3
---

Когда `docker build` идет не по плану.

## 1. Сборка идет очень долго (Sending build context)

**Симптом:**
Вы запускаете билд, и видите:
```
Sending build context to Docker daemon  500MB
```
И только через минуту начинается реальная работа.

**Причина:**
Вы не добавили `.dockerignore`. Docker копирует вашу папку `node_modules`, `.git`, видео с котиками и всё остальное демону перед началом сборки.

**Решение:**
Создайте `.dockerignore` и исключите всё лишнее.

## 2. npm install выполняется каждый раз

**Симптом:**
Вы поменяли одну строчку в коде, а Docker заново качает весь интернет (`npm install`), тратя 5 минут.

**Причина:**
Неправильный порядок слоев. Вы скопировали `COPY . .` **до** `RUN npm install`. Любое изменение кода сбрасывает кеш для установки пакетов.

**Решение:**
Сначала `COPY package.json`, потом `RUN npm install`, потом `COPY . .`.

## 3. "Файл не найден" при COPY

**Симптом:**
`COPY ./config/app.conf /app/` падает с ошибкой `file not found`.

**Причина:**
Вы думаете, что путь относительный от Dockerfile, но на самом деле он от **контекста сборки**.
Обычно контекст — это точка в конце команды: `docker build .`.

Если вы запускаете билд из другой папки: `docker build -f ./backend/Dockerfile .`, то контекст — текущая папка, а Dockerfile ищет файлы внутри `backend`.

**Решение:**
Всегда запускайте билд из корня проекта, или внимательно следите за путями.

## 4. Windows Line Endings (CRLF)

**Симптом:**
Баш-скрипт внутри контейнера падает с ошибкой: `/bin/sh^M: bad interpreter`.

**Причина:**
Вы редактировали файл `entrypoint.sh` в Windows (Notepad), и он сохранился с окончаниями строк `CRLF` (Carriage Return + Line Feed). Linux понимает только `LF`.

**Решение:**
Пересохраните файл с LF (в VS Code: справа снизу кнопка "CRLF" -> переключить на "LF"). Или настройте git `core.autocrlf`.

## Итого

Следите за контекстом, кешем и окончаниями строк. И не забывайте про `.dockerignore`.

