---
title: "Проблемы с сетью: connection refused, DNS"
category: "docker"
categoryTitle: "Docker"
section: "troubleshooting"
sectionTitle: "Типичные проблемы и решения"
sectionOrder: 10
order: 2
---

"Приложение не может подключиться к базе данных". Это самая частая боль новичков.

## Ошибка 1: Connection Refused (127.0.0.1)

**Ситуация:**
У вас в конфиге приложения написано: `DB_HOST=localhost`.
Приложение внутри контейнера пытается подключиться к `localhost`... и не находит там базы.

**Причина:**
Внутри контейнера `localhost` — это **сам контейнер**. База данных находится в **другом** контейнере.

**Решение:**
Используйте имя сервиса базы данных как хост: `DB_HOST=postgres` (или как вы назвали сервис в docker-compose).

## Ошибка 2: Host not found (DNS)

**Ситуация:**
Вы пишете `DB_HOST=postgres`, но получаете ошибку `getaddrinfo EAI_AGAIN postgres`.

**Причина:**
Контейнеры не находятся в одной пользовательской сети.
Если вы запускали их через `docker run` без флага `--network`, они попали в дефолтный `bridge`, где DNS по именам **не работает**.

**Решение:**
Создайте сеть и поместите оба контейнера туда:
```bash
docker network create my-net
docker run --network my-net ... db
docker run --network my-net ... app
```
(Docker Compose делает это автоматически).

## Ошибка 3: Connection refused (Wrong Port)

**Ситуация:**
`DB_HOST=postgres`, сеть есть, но соединения нет.

**Причина:**
1. База еще не успела запуститься (Race Condition). См. урок про `depends_on`.
2. Вы стучитесь не в тот порт. Postgres — 5432, MySQL — 3306, Redis — 6379.
3. База настроена слушать только `127.0.0.1` (внутри своего конфига `listen_addresses`). Ей нужно разрешить слушать `0.0.0.0`.

## Диагностика сети из контейнера

Установите `curl` или `nc` (netcat) внутри контейнера для проверки:

```bash
# Проверка DNS: видит ли он IP?
getent hosts postgres

# Проверка порта: открыт ли он?
nc -zv postgres 5432
```
Если `nc` пишет `Open`, значит сеть работает, и проблема в логике приложения (неверный пароль, имя базы).

## Итого

Забудьте слово `localhost` внутри контейнеров (если только вы не обращаетесь к процессу в *этом же* контейнере). Используйте имена сервисов.

