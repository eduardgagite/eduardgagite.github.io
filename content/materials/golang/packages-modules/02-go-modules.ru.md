---
title: "Модули и зависимости"
category: "golang"
categoryTitle: "Go"
section: "packages-modules"
sectionTitle: "Пакеты и модули"
sectionOrder: 4
order: 2
---

Раньше в Go управление зависимостями было болью. Существовал **GOPATH**, где весь код лежал в одном месте, и не было механизма версий. Два проекта могли требовать разные версии одной библиотеки — и начинался хаос.

С Go 1.11 появились **Go Modules** — современная система управления зависимостями. Она решает все эти проблемы.

## Что такое модуль

Модуль — это коллекция пакетов, у которой есть **имя** и **версии**. Обычно один Git-репозиторий = один модуль.

Сердце модуля — файл **go.mod** в корне проекта.

## Файл go.mod

```
module github.com/myname/myproject

go 1.22

require (
    github.com/google/uuid v1.6.0
    github.com/gin-gonic/gin v1.9.1
)
```

Что здесь:
- **module** — полное имя вашего модуля (обычно URL репозитория).
- **go** — минимальная версия Go, необходимая для сборки.
- **require** — список библиотек с точными версиями.

## Файл go.sum

В пару к **go.mod** всегда идет **go.sum**. Это файл безопасности. В нём хранятся **контрольные суммы** (хеши) всех скачанных библиотек.

Зачем? Чтобы гарантировать: если вы и ваш коллега скачаете **github.com/google/uuid v1.6.0**, вы получите **побайтово одинаковый** код. Никто не подменит библиотеку на вредоносную.

**Правила**:
- Никогда не редактируйте **go.sum** руками.
- Всегда коммитьте **go.sum** в Git (вместе с **go.mod**).

## Основные команды

### 1. Инициализация нового проекта

```
mkdir myapp && cd myapp
go mod init github.com/myname/myapp
```

Создаст **go.mod** с именем модуля. Для локальных экспериментов можно написать просто **go mod init myapp**.

### 2. Добавление библиотеки (go get)

```
go get github.com/google/uuid
```

Эта команда:
1. Скачает библиотеку (и все её зависимости).
2. Добавит строку в секцию **require** файла **go.mod**.
3. Обновит **go.sum**.

Можно указать конкретную версию:

```
go get github.com/google/uuid@v1.5.0
```

### 3. Наведение порядка (go mod tidy)

Самая полезная команда. Запускайте её **перед каждым коммитом**.

```
go mod tidy
```

Она делает две вещи:
1. **Добавляет** зависимости, которые вы используете в коде, но забыли добавить через **go get**.
2. **Удаляет** зависимости, которые есть в **go.mod**, но больше не используются в коде.

### 4. Обновление зависимостей

```
go get -u github.com/gin-gonic/gin

go get -u ./...
```

### 5. Скачивание всех зависимостей

Если вы клонировали чужой репозиторий и хотите скачать все библиотеки:

```
go mod download
```

## Семантическое версионирование

Go использует **semver** (Semantic Versioning): **vMAJOR.MINOR.PATCH**.

- **PATCH** (v1.2.**3**): Исправления багов. Обновлять безопасно.
- **MINOR** (v1.**2**.0): Новые фичи, но обратная совместимость сохранена.
- **MAJOR** (v**2**.0.0): Ломающие изменения. Старый код может не работать.

Когда мажорная версия >= 2, она добавляется в путь импорта:

```
import "github.com/user/lib/v2"
```

## Итог

1. **go mod init** — создать новый модуль.
2. **go get пакет** — добавить библиотеку.
3. **go mod tidy** — убрать мусор и зафиксировать зависимости. Запускайте перед каждым коммитом.
4. **go.mod** и **go.sum** — коммитьте оба файла в Git.
