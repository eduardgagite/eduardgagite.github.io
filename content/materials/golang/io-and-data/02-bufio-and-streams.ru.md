---
title: "Потоки и буферизация"
category: "golang"
categoryTitle: "Go"
section: "io-and-data"
sectionTitle: "I/O и данные"
sectionOrder: 5
order: 2
---

Что делать, если файл весит 10 ГБ, а памяти у вас всего 2 ГБ? Читать его целиком нельзя — программа упадет с `Out of Memory`.

Здесь на помощь приходят **потоки** (Streams). Идея проста: мы читаем файл не весь сразу, а маленькими кусочками (буфером), обрабатываем их и выбрасываем.

## Чтение построчно (bufio)

Пакет `bufio` (Buffered I/O) позволяет удобно читать текст строчка за строчкой.

```go
import (
    "bufio"
    "fmt"
    "os"
)

func main() {
    // 1. Открываем файл (он пока не читается в память)
    file, err := os.Open("big_log.txt")
    if err != nil {
        panic(err)
    }
    defer file.Close() // Не забудьте закрыть!

    // 2. Создаем сканер
    scanner := bufio.NewScanner(file)

    // 3. Читаем в цикле, пока есть строки
    for scanner.Scan() {
        line := scanner.Text() // Получаем текущую строку
        fmt.Println("Прочитал:", line)
    }

    // 4. Проверяем ошибки сканирования
    if err := scanner.Err(); err != nil {
        fmt.Println("Ошибка чтения:", err)
    }
}
```

Этот код может обработать файл любого размера, хоть терабайт, потребляя всего пару килобайт памяти.

## Интерфейс io.Reader

В Go всё, что можно прочитать, реализует интерфейс `io.Reader`. Это может быть файл, сетевое соединение, тело HTTP-запроса или просто буфер в памяти.

Это значит, что вы можете написать одну функцию, которая умеет читать данные откуда угодно.

```go
// Принимает не файл, а абстрактный "Читатель"
func processData(r io.Reader) {
    scanner := bufio.NewScanner(r)
    for scanner.Scan() {
        fmt.Println(scanner.Text())
    }
}

func main() {
    // Можно передать файл
    f, _ := os.Open("file.txt")
    processData(f)

    // А можно передать просто строку (через strings.NewReader)
    s := strings.NewReader("строка 1\nстрока 2")
    processData(s)
}
```

## Итог

1. Если файл большой — не используйте `os.ReadFile`.
2. Используйте `bufio.Scanner` для чтения текстовых файлов построчно.
3. Интерфейс `io.Reader` — мощный инструмент, позволяющий писать универсальный код, который не зависит от того, откуда приходят данные (диск, сеть или память).
