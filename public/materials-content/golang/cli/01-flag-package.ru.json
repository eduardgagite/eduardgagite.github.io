{"content":"\nCLI-утилиты — одна из сильных сторон Go. Язык компилируется в один бинарник без зависимостей, что делает дистрибуцию инструментов очень удобной. Стандартная библиотека включает пакет **flag** для разбора аргументов командной строки.\n\n## Основы пакета flag\n\nПакет **flag** разбирает флаги вида **-name value** и **-name=value**:\n\n```\npackage main\n\nimport (\n    \"flag\"\n    \"fmt\"\n)\n\nfunc main() {\n    host := flag.String(\"host\", \"localhost\", \"адрес сервера\")\n    port := flag.Int(\"port\", 8080, \"порт сервера\")\n    verbose := flag.Bool(\"verbose\", false, \"подробный вывод\")\n\n    flag.Parse()\n\n    fmt.Printf(\"Подключение к %s:%d\\n\", *host, *port)\n    if *verbose {\n        fmt.Println(\"Режим подробного вывода включён\")\n    }\n}\n```\n\nЗапуск:\n\n```\n./myapp -host=example.com -port=9090 -verbose\n./myapp -host example.com -port 9090\n```\n\nТри аргумента функций **flag.String/Int/Bool**:\n1. Имя флага.\n2. Значение по умолчанию.\n3. Описание (показывается в **-help**).\n\nВозвращаются **указатели** — разыменовывайте через **\\***.\n\n## Автоматическая справка\n\n**flag.Parse()** автоматически добавляет флаг **-help** (или **-h**):\n\n```\n./myapp -help\n\nUsage of ./myapp:\n  -host string\n        адрес сервера (default \"localhost\")\n  -port int\n        порт сервера (default 8080)\n  -verbose\n        подробный вывод\n```\n\n## Флаги, привязанные к переменным\n\nЕсли не хочется работать с указателями, используйте **flag.StringVar** и аналоги:\n\n```\nvar (\n    host    string\n    port    int\n    verbose bool\n)\n\nfunc main() {\n    flag.StringVar(&host, \"host\", \"localhost\", \"адрес сервера\")\n    flag.IntVar(&port, \"port\", 8080, \"порт сервера\")\n    flag.BoolVar(&verbose, \"verbose\", false, \"подробный вывод\")\n\n    flag.Parse()\n\n    fmt.Printf(\"Подключение к %s:%d\\n\", host, port)\n}\n```\n\nТеперь **host**, **port**, **verbose** — обычные переменные без разыменования.\n\n## Позиционные аргументы\n\nПосле всех флагов могут идти позиционные аргументы (без **-**). Получить их можно через **flag.Args()**:\n\n```\n// ./myapp -verbose file1.txt file2.txt\n\nflag.Parse()\nfiles := flag.Args()    // [\"file1.txt\", \"file2.txt\"]\nfmt.Println(flag.NArg()) // 2 — количество аргументов\n```\n\n## Кастомный тип флага\n\nДля нестандартных типов реализуйте интерфейс **flag.Value**:\n\n```\ntype StringSlice []string\n\nfunc (s *StringSlice) String() string {\n    return strings.Join(*s, \",\")\n}\n\nfunc (s *StringSlice) Set(value string) error {\n    *s = append(*s, value)\n    return nil\n}\n\nfunc main() {\n    var tags StringSlice\n    flag.Var(&tags, \"tag\", \"тег (можно указать несколько раз)\")\n    flag.Parse()\n\n    fmt.Println(tags)\n}\n```\n\nЗапуск: **./myapp -tag go -tag backend -tag api** → **[go backend api]**\n\n## FlagSet — подкоманды\n\nДля нескольких подкоманд (как у **git**: **git commit**, **git push**) используйте **flag.FlagSet**:\n\n```\nfunc main() {\n    if len(os.Args) < 2 {\n        fmt.Println(\"Использование: myapp <команда> [флаги]\")\n        os.Exit(1)\n    }\n\n    switch os.Args[1] {\n    case \"server\":\n        serverCmd := flag.NewFlagSet(\"server\", flag.ExitOnError)\n        port := serverCmd.Int(\"port\", 8080, \"порт\")\n        serverCmd.Parse(os.Args[2:])\n        fmt.Println(\"Запуск сервера на порту\", *port)\n\n    case \"migrate\":\n        migrateCmd := flag.NewFlagSet(\"migrate\", flag.ExitOnError)\n        dsn := migrateCmd.String(\"dsn\", \"\", \"строка подключения к БД\")\n        migrateCmd.Parse(os.Args[2:])\n        fmt.Println(\"Миграция БД:\", *dsn)\n\n    default:\n        fmt.Printf(\"Неизвестная команда: %s\\n\", os.Args[1])\n        os.Exit(1)\n    }\n}\n```\n\n## Ограничения пакета flag\n\nПакет **flag** прост, но у него есть ограничения:\n- Использует **-flag** вместо GNU-стиля **--flag**.\n- Нет поддержки коротких флагов (-v вместо --verbose).\n- Нет автодополнения.\n- Нет вложенных подкоманд.\n\nДля серьёзных CLI-инструментов используйте **cobra** (следующая статья).\n\n## Итого\n\nПакет **flag** — встроенный и достаточный для простых утилит. **flag.Parse()** обязателен перед использованием значений. Используйте **flag.StringVar** чтобы избежать разыменования указателей. Для подкоманд — **flag.FlagSet**. Для сложных CLI с подкомандами, --long-flags и автодополнением переходите на **cobra**.\n"}