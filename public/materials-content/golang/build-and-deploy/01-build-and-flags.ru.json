{"content":"\nОдно из главных преимуществ Go — простая и предсказуемая сборка. Результат компиляции — один бинарный файл, который можно скопировать на сервер и запустить. Без зависимостей, без рантайма, без Docker (хотя с Docker тоже отлично).\n\n## Базовая сборка\n\n```bash\ngo build\n```\n\nСоздаст бинарник с именем модуля в текущей папке. Чтобы задать имя:\n\n```bash\ngo build -o myapp\n```\n\n## Встраивание версии в бинарник\n\nКак узнать, какую версию приложения вы запустили на сервере? Хардкодить версию в коде — неудобно (забудете обновить).\n\nИспользуйте **ldflags** — флаги линковщика, которые подставляют значения переменных при компиляции.\n\n### Шаг 1: Объявляем переменные\n\n```go\npackage main\n\nimport \"fmt\"\n\n// Эти переменные будут заполнены при сборке\nvar (\n    Version   = \"dev\"\n    BuildTime = \"unknown\"\n    GitCommit = \"unknown\"\n)\n\nfunc main() {\n    fmt.Printf(\"Версия: %s\\n\", Version)\n    fmt.Printf(\"Время сборки: %s\\n\", BuildTime)\n    fmt.Printf(\"Коммит: %s\\n\", GitCommit)\n}\n```\n\n### Шаг 2: Передаем значения при сборке\n\n```bash\ngo build -ldflags \"-X main.Version=1.2.3 -X main.BuildTime=$(date -u '+%Y-%m-%d_%H:%M:%S') -X main.GitCommit=$(git rev-parse --short HEAD)\" -o myapp\n```\n\nТеперь при запуске `./myapp` вы увидите:\n```\nВерсия: 1.2.3\nВремя сборки: 2025-01-28_14:30:00\nКоммит: a1b2c3d\n```\n\n## Оптимизация размера\n\nПо умолчанию бинарник содержит отладочную информацию. Её можно убрать:\n\n```bash\ngo build -ldflags \"-s -w\" -o myapp\n```\n\n- `-s` — убирает таблицу символов.\n- `-w` — убирает DWARF отладочную информацию.\n\nЭто может сократить размер бинарника на 20-30%.\n\n## Makefile\n\nЧтобы не запоминать длинные команды, используйте `Makefile`:\n\n```makefile\nVERSION := $(shell git describe --tags --always)\nBUILD_TIME := $(shell date -u '+%Y-%m-%d_%H:%M:%S')\nCOMMIT := $(shell git rev-parse --short HEAD)\nLDFLAGS := -X main.Version=$(VERSION) -X main.BuildTime=$(BUILD_TIME) -X main.GitCommit=$(COMMIT)\n\nbuild:\n\tgo build -ldflags \"$(LDFLAGS)\" -o bin/myapp ./cmd/api\n\ntest:\n\tgo test -v ./...\n\nrun: build\n\t./bin/myapp\n```\n\nТеперь:\n```bash\nmake build   # Собрать\nmake test    # Тесты\nmake run     # Собрать и запустить\n```\n\n## Итог\n\n1. `go build -o name` — собирает один самодостаточный бинарник.\n2. `-ldflags \"-X main.Version=...\"` — встраивает версию, коммит, дату сборки.\n3. `-ldflags \"-s -w\"` — уменьшает размер бинарника.\n4. `Makefile` — автоматизация сборки.\n"}