{"content":"\nПомимо оперативной памяти, **Redis** умеет сохранять снимки данных на диск в виде **RDB-файлов**. С точки зрения управления памятью важно не то, как именно устроены snapshot, а как они влияют на расход RAM и нагрузку под высокой записью.\n\nЗа общую механику RDB и персистентность в целом отвечает отдельный раздел про персистентность данных. Здесь сосредоточимся именно на памяти и типичных проблемах при включённых snapshot.\n\n## Автоматические snapshot и их влияние\n\nВ конфиге Redis часто можно увидеть строки вида:\n\n```\nsave 900 1\nsave 300 10\nsave 60 10000\n```\n\nЭто означает:\n\n- если за 900 секунд был хотя бы 1 запрос на изменение данных — сделать snapshot;\n- если за 300 секунд было 10 изменений — тоже сохранить;\n- если за 60 секунд было 10000 изменений — снова сохранить.\n\nПри каждом таком срабатывании Redis будет запускать **BGSAVE**, то есть делать копию данных в памяти и писать её на диск. Для небольших инстансов это дёшево, но при десятках гигабайт данных:\n\n- возрастает потребление памяти из‑за copy-on-write;\n- возможны короткие пики нагрузки на диск;\n- время BGSAVE может стать заметным.\n\nЕсли Redis используется как чистый кэш и потеря данных допустима, автоматические snapshot часто отключают:\n\n```\nCONFIG SET save \"\"\n```\n\nВ этом режиме RDB-файлы не создаются, а объём памяти и нагрузка на диск предсказуемее.\n\n## Snapshot и память: что важно учитывать\n\nПри запуске **BGSAVE** Redis делает fork процесса. Операционная система использует механизм copy-on-write: страницы памяти копируются только при изменении. Но если в момент snapshot идёт активная запись, реальное потребление памяти может заметно вырасти.\n\nПрактические рекомендации:\n\n- не запускать **SAVE** на больших базах в продакшене;\n- планировать **BGSAVE** на спокойные периоды с меньшим количеством записей;\n- учитывать запас памяти на сервере, если объём данных в Redis уже близок к лимиту.\n\nЕсли лимит памяти и политики вытеснения настроены агрессивно, а snapshot включён часто, можно неожиданно уткнуться в недостаток RAM во время BGSAVE.\n\n## Итог\n\nSnapshot в **Redis** — это не только про персистентность, но и про память: при запуске BGSAVE возрастает потребление RAM и нагрузка на диск, что может стать проблемой на загруженных или уже «заполненных» инстансах.\n\nЕсли воспринимать snapshot как ещё один фактор, влияющий на расход памяти, и планировать их с учётом лимитов **maxmemory** и профиля нагрузки, можно спокойно использовать RDB, не получая неожиданных отказов по памяти.\n\n"}