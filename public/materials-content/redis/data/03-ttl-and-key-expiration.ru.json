{"content":"\n**TTL** позволяет сделать ключи «временными». По умолчанию данные в Redis живут вечно, пока их явно не удалить. Время жизни ключа задаётся отдельно и измеряется в секундах или миллисекундах.\n\n## Основная идея\n\nМожно записать значение, дать ему срок жизни и не думать о ручной очистке. После истечения срока Redis удалит ключ сам. Это удобно для кэша, сессий, одноразовых кодов и временных флагов.\n\n**Простейший пример:**\n\n```\nSET session:123 \"user data\"\nEXPIRE session:123 60\n```\n\nКлюч session:123 будет жить 60 секунд, потом исчезнет.\n\n**Проверка оставшегося времени:**\n\n```\nTTL session:123\n```\n\nЕсли ключ ещё жив, возвращается число секунд. Возможны специальные значения:\n- **-1** — у ключа нет срока жизни;\n- **-2** — ключ уже не существует.\n\n## Запись сразу с временем жизни\n\nМожно не вызывать EXPIRE отдельно, а задать срок прямо при записи.\n\n**SETEX — запись сразу с временем жизни (в секундах):**\n\n```\nSETEX cache:user:1 300 \"{\\\"name\\\":\\\"Alice\\\"}\"\n```\n\nКлюч cache:user:1 будет автоматически удалён через 300 секунд.\n\n**PSETEX — вариант с миллисекундами:**\n\n```\nPSETEX cache:page:1 1500 \"html...\"\n```\n\n## Снятие срока жизни\n\n**PERSIST — сделать ключ снова постоянным:**\n\n```\nPERSIST session:123\n```\n\nПосле этого у ключа больше нет таймера удаления.\n\nВажно помнить: если перезаписать значение, TTL сбрасывается. Новое значение будет без срока жизни, пока его не задать заново.\n\n## Поведение при истечении\n\nRedis не удаляет ключи строго в ту же миллисекунду, когда истечёт время. Он периодически проверяет истекающие ключи и дополнительно удаляет их при обращении. Для приложения это выглядит так, будто ключ просто перестал существовать:\n\n```\nGET session:123\n```\n\nДо истечения Redis вернёт сохранённое значение. После — **(nil)**, как будто ключа никогда не было.\n\n## Практические случаи\n\n**Кэш.** Хранить результат тяжёлого запроса несколько секунд или минут.\n\n```\nSETEX cache:popular:posts 60 \"...\"\n```\n\n**Сессии.** Хранить данные пользователя, пока он активен.\n\n```\nSET session:456 \"data\"\nEXPIRE session:456 1800\n```\n\n**Одноразовые коды и токены.** Срок действия задаётся сразу и не требует ручной очистки.\n\nГрамотная работа с TTL помогает не захламлять память Redis и автоматически удалять ненужные данные.\n\n## Итого по TTL и командам\n\nTTL делает ключи временными и позволяет не заниматься ручной очисткой. У каждого ключа может быть свой срок жизни: его можно задать при записи, изменить, снять или проверить.\n\nКоманды, которые важно знать:\n\n- **EXPIRE key seconds** — установить время жизни в секундах.\n- **PEXPIRE key milliseconds** — то же самое, но в миллисекундах.\n- **EXPIREAT key timestamp** — истечение по Unix-времени в секундах.\n- **PEXPIREAT key milliseconds-timestamp** — истечение по Unix-времени в миллисекундах.\n- **TTL key** — показать оставшееся время жизни в секундах.\n- **PTTL key** — показать оставшееся время жизни в миллисекундах.\n- **SETEX key seconds value** — записать значение и сразу задать срок жизни.\n- **PSETEX key milliseconds value** — вариант с миллисекундами.\n- **PERSIST key** — убрать время жизни и сделать ключ постоянным.\n\nПонимая, как работают эти команды, можно строить кэш, сессии, временные токены и любые другие механизмы, которые должны исчезать сами через заданный промежуток времени.\n"}