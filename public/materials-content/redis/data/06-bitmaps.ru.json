{"content":"\n**Bitmaps** в Redis — это способ хранить и обрабатывать данные на уровне отдельных битов. Внутри это обычные строки, но команды **BIT*** позволяют работать с ними как с массивами битов. Это даёт очень компактное хранение для задач, где нужно отмечать наличие или отсутствие чего‑то: активность пользователя по дням, флаги, бинарные состояния.\n\nГлавное преимущество — экономия памяти: один бит вместо целого числа или строки. Для больших массивов данных это может дать существенную экономию.\n\n## Установка и чтение битов\n\nКоманда **SETBIT** устанавливает бит в позицию 0 или 1, а **GETBIT** читает значение бита.\n\nПример отметки активности пользователя по дням:\n\n```\nSETBIT user:42:activity 0 1\nSETBIT user:42:activity 1 1\nSETBIT user:42:activity 2 0\nSETBIT user:42:activity 3 1\n```\n\nЗдесь:\n\n- **user:42:activity** — ключ для хранения битов;\n- первое число — позиция бита (например, день недели или день месяца);\n- последнее число — значение: **1** (активен) или **0** (неактивен).\n\nПроверка активности в конкретный день:\n\n```\nGETBIT user:42:activity 3\n```\n\nКоманда вернёт **1**, если пользователь был активен, и **0**, если нет.\n\n## Подсчёт установленных битов\n\nКоманда **BITCOUNT** считает, сколько битов установлено в 1.\n\nПример:\n\n```\nBITCOUNT user:42:activity\n```\n\nЭто полезно для быстрого подсчёта: сколько дней пользователь был активен, сколько флагов установлено, сколько событий произошло.\n\nМожно считать биты в определённом диапазоне:\n\n```\nBITCOUNT user:42:activity 0 6\n```\n\nЗдесь считаются биты с позиции 0 по 6 (например, активность за неделю).\n\n## Битовая операция AND\n\nКоманда **BITOP AND** выполняет побитовое И между несколькими bitmap и сохраняет результат в новый ключ.\n\nПример поиска пользователей, активных в оба дня:\n\n```\nSETBIT user:42:activity 0 1\nSETBIT user:42:activity 1 1\nSETBIT user:100:activity 0 1\nSETBIT user:100:activity 1 0\n\nBITOP AND result user:42:activity user:100:activity\nGETBIT result 0\n```\n\nРезультат будет содержать **1** только в тех позициях, где оба исходных bitmap имели **1**.\n\nЭто удобно для поиска пересечений: какие пользователи были активны и в понедельник, и во вторник.\n\n## Битовая операция OR\n\nКоманда **BITOP OR** выполняет побитовое ИЛИ — результат содержит **1**, если хотя бы в одном из bitmap бит установлен.\n\nПример:\n\n```\nBITOP OR result user:42:activity user:100:activity\n```\n\nЭто полезно для объединения данных: активность хотя бы одного из пользователей, события из разных источников.\n\n## Битовая операция XOR\n\nКоманда **BITOP XOR** возвращает **1** только там, где биты различаются между bitmap.\n\nПример:\n\n```\nBITOP XOR result user:42:activity user:100:activity\n```\n\nЭто можно использовать для поиска различий: какие дни отличаются между двумя пользователями.\n\n## Битовая операция NOT\n\nКоманда **BITOP NOT** инвертирует все биты в bitmap.\n\nПример:\n\n```\nBITOP NOT inverted user:42:activity\n```\n\nТеперь **inverted** содержит обращённые значения: где было **1**, стало **0**, и наоборот.\n\n## Поиск первого установленного бита\n\nКоманда **BITPOS** находит позицию первого бита с заданным значением.\n\nПример поиска первого дня активности:\n\n```\nBITPOS user:42:activity 1\n```\n\nКоманда вернёт номер позиции первого установленного бита. Если нужно найти первый **0**, указывают:\n\n```\nBITPOS user:42:activity 0\n```\n\nМожно искать в определённом диапазоне:\n\n```\nBITPOS user:42:activity 1 0 6\n```\n\n## Практические сценарии\n\n**Отслеживание активности по дням.** Каждый день месяца — один бит. Если пользователь был активен, бит устанавливается в **1**.\n\n```\nSETBIT user:42:activity:2025-11 20 1\nBITCOUNT user:42:activity:2025-11\n```\n\n**Флаги и настройки.** Разные биты хранят разные флаги: уведомления включены, подписка активна, верификация пройдена.\n\n```\nSETBIT user:42:flags 0 1\nSETBIT user:42:flags 1 0\nSETBIT user:42:flags 2 1\n```\n\n**Аналитика пересечений.** Какие пользователи были активны и в понедельник, и во вторник, и в среду.\n\n```\nBITOP AND weekdays monday tuesday wednesday\nBITCOUNT weekdays\n```\n\n**Отслеживание уникальных событий.** Каждое событие — один бит. Если событие произошло, бит устанавливается. **BITCOUNT** показывает, сколько уникальных событий было.\n\n## Ограничения и особенности\n\nBitmaps эффективны, когда данных много, а значения бинарные (есть/нет). Если нужно хранить сложные структуры или частые обновления затрагивают большие диапазоны, лучше использовать другие структуры.\n\nВажно помнить:\n\n- позиции битов должны быть неотрицательными целыми числами;\n- для очень больших позиций (миллионы) память всё равно будет заниматься, даже если установлено мало битов;\n- операции **BITOP** создают новый ключ, что требует дополнительной памяти.\n\n## Итого\n\n**Bitmaps в Redis** дают компактный способ хранить бинарные данные и выполнять быстрые операции над ними: подсчёт установленных битов, поиск пересечений, объединение данных.\n\nДля задач вроде отслеживания активности, хранения флагов и анализа больших массивов бинарных данных **BIT*** команды предоставляют эффективный инструмент с минимальным расходом памяти.\n\n"}