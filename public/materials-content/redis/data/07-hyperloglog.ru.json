{"content":"\n**HyperLogLog** — это структура данных для приблизительного подсчёта количества уникальных элементов. Она не хранит сами элементы, а только оценивает, сколько их было. За счёт этого **HyperLogLog** занимает очень мало памяти — всего около 12 килобайт на структуру — и может обрабатывать миллиарды уникальных значений.\n\nТочность оценки обычно составляет около 0.81% стандартной ошибки, что для большинства аналитических задач вполне достаточно. Если нужен точный подсчёт уникальных элементов, лучше использовать обычные множества, но они занимают намного больше памяти.\n\n## Добавление элементов\n\nКоманда **PFADD** добавляет один или несколько элементов в структуру.\n\nПример подсчёта уникальных посетителей сайта:\n\n```\nPFADD visitors:2025-11-21 user_42\nPFADD visitors:2025-11-21 user_100\nPFADD visitors:2025-11-21 user_42\n```\n\nЗдесь:\n\n- **visitors:2025-11-21** — ключ для хранения структуры за конкретный день;\n- **user_42**, **user_100** — идентификаторы посетителей.\n\nЕсли один и тот же элемент добавляется несколько раз (как **user_42** в примере), структура учитывает его только один раз.\n\nМожно добавить несколько элементов за один вызов:\n\n```\nPFADD visitors:2025-11-21 user_42 user_100 user_789\n```\n\n## Получение оценки количества уникальных элементов\n\nКоманда **PFCOUNT** возвращает приблизительное количество уникальных элементов.\n\nПример:\n\n```\nPFCOUNT visitors:2025-11-21\n```\n\nКоманда вернёт число, например **1523**, которое означает, что примерно столько уникальных посетителей было за день.\n\nВажно понимать, что это оценка, а не точное значение. Для большинства аналитических задач такая точность достаточна, особенно когда речь идёт о миллионах или миллиардах элементов.\n\n## Объединение нескольких HyperLogLog\n\nКоманда **PFMERGE** объединяет несколько структур в одну. Это полезно, когда нужно посчитать уникальные элементы за период: например, за неделю или месяц.\n\nПример объединения данных за несколько дней:\n\n```\nPFADD visitors:2025-11-21 user_42 user_100\nPFADD visitors:2025-11-22 user_42 user_200\nPFADD visitors:2025-11-23 user_100 user_200\n\nPFMERGE visitors:week visitors:2025-11-21 visitors:2025-11-22 visitors:2025-11-23\nPFCOUNT visitors:week\n```\n\nРезультат покажет приблизительное количество уникальных посетителей за всю неделю, учитывая, что один и тот же пользователь мог заходить в разные дни.\n\n## Практические сценарии\n\n**Подсчёт уникальных посетителей.** Каждый визит добавляется в структуру, **PFCOUNT** показывает оценку уникальных пользователей за день, неделю, месяц.\n\n```\nPFADD visitors:2025-11-21 \"192.168.1.1\"\nPFADD visitors:2025-11-21 \"192.168.1.2\"\nPFCOUNT visitors:2025-11-21\n```\n\n**Аналитика поисковых запросов.** Сколько уникальных поисковых запросов было за период.\n\n```\nPFADD searches:2025-11-21 \"redis tutorial\"\nPFADD searches:2025-11-21 \"redis caching\"\nPFCOUNT searches:2025-11-21\n```\n\n**Отслеживание уникальных событий.** Сколько уникальных пользователей выполнили действие (кликнули, подписались, купили).\n\n```\nPFADD clicks:button:buy:2025-11-21 user_42\nPFADD clicks:button:buy:2025-11-21 user_100\nPFCOUNT clicks:button:buy:2025-11-21\n```\n\n**Агрегация по регионам или категориям.** Уникальные посетители по странам, уникальные товары по категориям.\n\n```\nPFADD visitors:country:US:2025-11-21 user_1\nPFADD visitors:country:US:2025-11-21 user_2\nPFADD visitors:country:RU:2025-11-21 user_3\nPFCOUNT visitors:country:US:2025-11-21\n```\n\n## Сравнение с обычными множествами\n\nДля точного подсчёта уникальных элементов можно использовать обычные множества:\n\n```\nSADD visitors:exact:2025-11-21 user_42\nSADD visitors:exact:2025-11-21 user_100\nSCARD visitors:exact:2025-11-21\n```\n\nНо есть важные различия:\n\n- **Память:** множество хранит все элементы и занимает память пропорционально количеству элементов. **HyperLogLog** всегда занимает около 12 КБ.\n- **Точность:** множество даёт точный результат, **HyperLogLog** — приблизительный (ошибка около 0.81%).\n- **Скорость:** оба варианта быстрые, но **HyperLogLog** обычно быстрее при больших объёмах данных.\n\nВыбор зависит от задачи: если нужна точность и элементов немного (тысячи, десятки тысяч), лучше множества. Если элементов миллионы или миллиарды, а небольшая погрешность допустима, **HyperLogLog** сэкономит много памяти.\n\n## Ограничения и особенности\n\n**HyperLogLog** не позволяет:\n\n- получить список элементов (структура их не хранит);\n- проверить, был ли конкретный элемент добавлен;\n- удалить отдельный элемент.\n\nЕсли нужны такие операции, лучше использовать обычные множества или другие структуры.\n\nВажно помнить:\n\n- оценка может отличаться от реального значения на 0.81% в среднем;\n- структура занимает фиксированный объём памяти (около 12 КБ), независимо от количества элементов;\n- при объединении нескольких структур точность сохраняется.\n\n## Итого\n\n**HyperLogLog в Redis** даёт компактный способ приблизительно подсчитывать уникальные элементы в огромных потоках данных, занимая при этом минимум памяти.\n\nДля аналитических задач, где важна оценка количества уникальных значений (посетители, события, запросы), а не точный список элементов, **PFADD** и **PFCOUNT** предоставляют эффективное решение с минимальным расходом ресурсов.\n\n"}